---
title: "共享单车停在哪里？——新城市的停放热点挖掘"
cover: "/images/ParkingHotspots5.png"
tags: ["数据挖掘", "KDD", "深度学习", "神经网络"]
date: 2018-11-01T11:39:40+08:00
---

在现在共享单车大背景下，胡乱停车给人们带来了很多困扰。因此，对一个新城市，如何提前预测停车热点，更好的规划城市，是一个重要的问题。该问题衍生了三个挑战：道路热度的定义；热点随时间的变化；热点和地理特征的关系（领域转移）。本文提出了利用 KDE 测量道路热度的方法，并引入了一个新型的领域适应的神经网络 ConvCDAN，用于在源城市和目标城市之间转移热点知识和进行预测。最后，多种实验证明了本文方法的有效性。

<!--more-->

[原文链接：Where Will Dockless Shared Bikes be Stacked? — Parking Hotspots Detection in a New City](/files/Parking-Hotspots.pdf)

# 一、介绍
- 背景：共享单车大背景下，胡乱停车带来了很多困扰 
- 问题：对一个新城市，如何提前预测停车热点
	- 对运营商：更好的投放和部署
	- 对政府：更好的更新自行车法规和预先建立电子停车位
- 挑战：
	- 如何定义道路热度（需要减轻道路长度变化的影响）
	- 热点随时间变化
	- 热点和地理特征相关（领域转移问题）
- 解决方案：
	- 道路热度和热点：
		- 基于全市的自行车概率密度函数来量化道路热度
		- 采用核密度估计来估算自行车在全市的停放概率
		- 中心点高密度值路段被定义为热点
	- 时间变化：根据对 Mobike 的数据分析，由于自行车路线短距离的性质，热点随时间变化较小
	- 地理特征相关：
		- 城市特征学习：用多源城市数据（POI、路网、卫星图），学习关于热点的判别特征
		- 领域转移问题：ConvCDAN，新型卷积城市域适应网络，用于将源城市的知识转移。具体，当仅提供源城市自行车记录时，模型自动检测目标城市热点。包括三部分：
			1. FeatureNet：源城市学习到的判别特征
			2. DensityNet：预测道路自行车密度
			3. DomainNet：将 FeatureNet 中的功能提升为领域不变的更深层的表示
- 贡献：
	- 问题解决（第 2 节）
	- 核密度估计来测量道路热度（第 3 节）
	- 特征提取 + ConvCDAN 热点预测检测（第 4 节）
	- 评估（第 5 节）

# 二、初步
- 道路边界矩形、中心点：
	- 边界矩形即道路凸包矩形
	- 中心点即矩形对角线交点
- 道路热度：
	- 方法：道路中心点的平均每时自行车密度
	- 考虑时变因素，观察发现，热点随时间的变化是相对小的
	- 利用核密度估计（KDE）计算全市自行车密度函数
- 城市热点：道路热度 top k
- 问题描述：
	- 概述：热点知识的城市间转移
	- 具体：预测目标城市的道路自行车密度，得到热度最高的 k 个路段作为城市热点

# 三、热点发现和分析
## 3.1 利用核密度估计（KDE）发掘热点
- 思路：
	1. 通过 KDE 评估自行车在全市停放的概率密度函数
	2. 再评估道路中心点平均密度值，作为道路热度

## 3.2 热点的时空属性分析
![](/images/ParkingHotspots1.png)

### 3.2.1 时间属性：
- 思路：
	- 将两个临近时间窗口的热点道路重叠率作为相似分数
- 结果1（北京、不同窗口大小）：见左图
	1. 不同时间窗口大小时，热点结果相似，平均分分别为0.49、0.54和0.67
	2. 窗口大小1小时和3小时，得分趋势按天呈周期性变化
- 结果2（不同城市）：见中图
	1. 不同城市间，连续时间窗口的热点是稳定的（分数很高）
	2. 上海相似度最低、其次是北京、宁波，原因是上海路网最复杂。
- 结论：
	- 热点的时间稳定性，可能是由于自行车短骑行距离的特性

### 3.2.2 空间属性
- 结果：见右图
	1. 许多热点是空间临近的，由于路网连通性。
	2. 商业中心、交通枢纽、住宅区附近的道路更有可能成为热点。
- 结论：
	- 热点和城市地理信息紧密关联，有利于从多个城市数据源提取高辨识的特征

# 四、在新城市发掘热点
## 4.1 特征提取
- 思路：从道路边界矩形范围内提取特征
- 特征分类：
	- POI：每个种类频率、总数、熵（反映信息不确定性）
	- 路网：道路类型、覆盖道路数量
	- 卫星图像：平均光强、到最近光中心的距离
	- 交通：离最近地铁站的距离、小于3公里的地铁站数量
	- 商业中心：离最近的商业中心的距离、最近商业中心等级

## 4.2 特征关联和领域分析
### 4.2.1 特征关联分析
- 采用皮尔逊相关系数，计算和道路热度关联最强的10个特征

![](/images/ParkingHotspots2.png)

### 4.2.2 城市间领域分析
- 特征领域转移：
	1. 采用最大平均差异（MMD）来量化源城市和目标城市的差异。其中 u 是城市特征平均化后的特征向量。公式：
		
		![](/images/ParkingHotspots3.png)
	2. TSNE 可视化降维
- 结果：
![](/images/ParkingHotspots4.png)
- 结论：存在不同城市的知识转移，需要用引入一个城市领域的适应方法。

## 4.3 城市领域适应网络
![](/images/ParkingHotspots5.png)

- ConvCDAN：
	1. FeatureNet：源城市学习到的判别特征
	2. DensityNet：预测道路自行车密度
	3. DomainNet：将 FeatureNet 中的功能提升为领域不变的更深层的表示

### 4.3.1 FeatureNet
- 输入：获取热点附近的 n 条路网，将路网特征矩阵（m * n）作为输入
- 结构：两个卷积块（每个包含两个卷积层）+一个池化层
	- 第一层卷积：1 * m 卷积核，有 k 个 channel，作用是寻找特定特征。
	- 第二层卷积：3 * k 卷积核，有 k^2 个 channel，作用是发掘临近道路的特征。
	- 激活函数：ReLU

### 4.3.2 DensityNet
- 结构：两个全连接前馈层和一个输出层
- 激活函数：ReLU
- 训练集：源城市数据
- 代价函数：结合回归损失和排名损失

### 4.3.3 DomainNet
- 知识转移解决思路：
	1. 学习新的领域不变特征空间时匹配源和目标特征分布。
- DomainNet：
	- 作用：一个领域分类网络，监督 FeatureNet 学习判别的和可转移的特征。具体的，将输入特征分类到对应领域。
	- 结构：两个全连接前馈层和一个输出层
	- 激活函数：Sigmoid

### 4.3.4 ConvCDAN 优化


# 五、实验
## 5.1 实验设置
- 数据集：Mobike 上海、北京、宁波，一个月数据
- 比较方法
	- 基线：Lasso Regression、GBRT、MLP、RankNet、LambdaMart
	- 评估策略：K 表示 top K
		- MAP@K：预测平均准确率
		- NDCG@K：评估排名相关性

## 5.2 比较结果
- 预测顺序：北京 -> 宁波、上海 -> 宁波、上海 -> 北京，符合客观现实。
- 比较结果：ConvCDAN 全部性能最佳。
- 一些发现：
	- 所有方法都至少 30% 准确率，表明停放位置与多源数据的地理信息紧密相关。
	- 北京->宁波 > 上海->北京 > 上海->宁波，潜在原因是道路网络的复杂性，三个城市的道路数量分别是 12916、8913、1242。

![](/images/ParkingHotspots7.png)

## 5.3 FeatureNet 中卷积操作的影响
![](/images/ParkingHotspots6.png)

## 5.4 DensityNet 中 Ranking Loss 的影响


## 5.5 DomainNet 的集成效果


# 思考
- 我对深度学习还是懂的太少，理解不够
- 优点：
	- 逻辑推导很缜密：挖掘->分析->指导下一步
	- 定义问题和解决方案思考的很透彻
	- 代价函数：考虑因素较全面
- 缺点：
	- 特征提取：从道路边界矩形提取的空间特征，不够完整
	- 特征关联：Top 10 的划分方式没有依据
	- 领域分析：平均化的特征用于城市比较，准确度不够

---

# 补充材料
## 概率分布和概率密度
- 对离散型随机变量：
	- 概率函数：函数结果是各个取值的概率，eg：P(1) = 0.5
	- 概率分布函数：函数结果是各个区间分布的概率，eg：F(x < 1) = 0.3
- 对连续型随机变量：
	- 概率密度函数：
		- 对应离散型的概率函数，然而连续性随机变量通常不存在具体的某个值的概率，而是某个区间的概率。
		- 具体解释是，事件 { x < X < x+h } 的概率应为 F(x+h)-F(x)。所以比值 [F(x+h)-F(x)]/h(h->0) 可以解释为单位概率。F'(x)=f(x)，f(x)为概率密度函数。
		- 反映了概率在 x 点处的密集程度。

![](/images/ParkingHotspotsSupplement1.png) 

## 核密度估计（KDE）
- 密度估计：
	- 参数估计：通过某种模型去拟合数据分布，调节模型参数
	- 非参数估计：例如核密度估计
- 核密度估计：
	- 作用：估计未知的概率密度函数。具体来说是对直方图的自然拓展，将直方图进行平滑连续化模拟。
	- 原理：近大远小。如果某一个数在观察中出现了，我们可以认为这个数的概率密度很大，和这个数比较近的数的概率密度也会比较大，而那些离这个数远的数的概率密度会比较小。
	- 核函数：用于拟合近大远小的概率密度变化。
	- 具体数学原理见 [here](https://www.zhihu.com/question/27301358)

## 排名评价指标
- MAP、DCG、NDCG，[here](http://www.cnblogs.com/by-dream/p/9403984.html)








