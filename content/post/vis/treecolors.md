---
title: "Tree Colors：层次结构数据的配色方案选择"
date: 2018-05-31T14:00:53+08:00
tags: ["数据可视化", "TVCG"]
cover: "/images/blogs/vis/Tree Colors4.png"
---

数据通常显式或隐式的带有层次结构。例子：商务数据可以分解为经济活动、地理区域人口数据。在数据可视化中，颜色是一个重要的视觉编码元素。在可视分析中，好的配色方案对反映层次结构是有帮助的。对节点连接图，甚至可以放松树的布局来获取更多空间、通过颜色增强对层次结构关系的表达。本文就将介绍，如何获得层次结构数据的最优配色方案。

<!--more-->

[原文链接：Tree Colors: Color Schemes for Tree-Structured Data](/files/papers/Tree Colors.pdf)

# 一、介绍
- 背景：
	- 数据通常显式或隐式的带有层次结构。例子：商务数据可以分解为经济活动、地理区域人口数据
	- 在数据可视化中，颜色是一个重要的视觉编码元素
- 需求：
	- 在可视分析中，好的配色方案对反映层次结构是有帮助的。对节点连接图，甚至可以放松树的布局来获取更多空间、通过颜色增强对层次结构关系的表达。
- 现状：
	- 简单的数据配色方案是易得的。然而，层次结构数据的配色问题，尚无特别的研究和指导
- 解决方案：带着以下几项考虑，设计了一个层次结构配色方案 Tree Colors
	- 是一种定性的配色方案，为每个树节点分配一个唯一的、没有感知顺序的颜色
	- 编码了父子关系，子节点颜色和父节点相似
	- 节点深度可以通过颜色来反映
- 颜色空间：
	- HCL（色调-色度-亮度）空间。优点在于，更利于人的感知，不同色调值的颜色在色彩和亮度上的感知是均匀的。这一点 HSV、HSL 颜色空间都无法做到。
- 评估：
	- 方法：将 Tree Colors 和一种树的每个主支具有不同的颜色的配色方案作比较
	- 结果：Tree Colors 在树形结构可视化中是有效的
	- 不足：树形图的结果是混合的，此领域需要更多的研究
- Outline：
	- 第二章：相关工作
	- 第三章：配色方案描述
	- 第四章：开发软件
	- 第五章：应用探索
	- 第六章：user study（评估）
	- 第七章：结论和讨论

# 二、相关工作
- InterRing：
	- 叶子节点不同色调。
	- 父节点的颜色是子节点的加权平均，会导致高层次节点颜色是低饱和度的。
- Hyperbolic Wheel：
	- 使用 HSL。
	- 亮度从根到叶子逐渐减少。
	- 子节点色调继承父节点色调，但有小的不同，可能会导致同层色调重复。
- 很多网站都应用了颜色来可视编码树形结构：
	- newsmap.jp：
		- 使用 HCL
		- 同层 nodes 之间色度、亮度不同但色调相同
		- 这和 Tree Colors 相反
	- IBM's Many Eyes：
		- 使用 HSV
		- 同层 nodes 之间色调不同但饱和度、亮度相同
		- 类似 Tree Colors
- 存在的问题：对于构建树形层次结构配色，（已有使用案例但）尚没有指导或描述。

# 三、方法
- 将树形结构映射到 HCL 空间
	- H：范围 [0, 360]，同层 nodes 色调不同，且都和父节点色调类似。
	- C、L：范围 [0, 100]，同层 nodes 色度和亮度相同，用于区分不同的层次结构。

## 3.1 色调
- 递归算法：用于给每个节点赋值色调
	- 输入：树节点 v；色调范围 r；色调分数 f；布尔值 perm、rev
	- 算法逻辑：
		1. 选择色调范围中值，作为节点 v 的色调值。
		2. 设 N 为子节点数量，如果 N 大于 0：
			1. 将 r 分为 N 等分
			2. if perm，重排列所有等分块
			3. if rev，反转偶数节点的子节点
			4. 根据色调分数，减少每个等分块
			5. 对每个子节点，递归调用该函数

	![](/images/blogs/vis/Tree Colors1.png)
- 色调排列和反转
	- 重排列：
		- 原因：在大多数层次结构中，同级节点没有顺序。因此，同级节点的颜色不应该引入感知顺序
		- 解决方案：基于X元素排列，例如 5 元素排序 [1, 3, 5, 2, 4]，每两个临近节点相差 2/5 * 360 = 144°。
		- 例子：对于位置为 [1, 2, 3, 4, 5] 的兄弟节点，颜色分配算法为 [1, 3, 5, 2, 4]，则重排列后的颜色位置为 [1, 4, 2, 5, 3] 
	
	![](/images/blogs/vis/Tree Colors2.png)
	
	- 反转：
		- 原因：不同父亲的同级临近节点，颜色距离不够大，容易产生认知偏差。
		- 解决方案：反转偶数节点的子节点的颜色分配，以增加不同父亲的相邻邻接节点的色调距离。
		- 例子：[A.1, A.3, A.2] [B.2, B.3, B.1] [C.1, C.3, C.2]

	![](/images/blogs/vis/Tree Colors3.png)
	
	- 适用范围：兄弟节点线性或径向分布时。
- 色调分数：
	- the percentage of hue range available
	- 是一个权衡
		- 分辨不同主支（f 小，可用 range 小，主支 gap 大）
		- 分辨一主支下不同分支（f 大，可用 range 大，主支 gap 小）
	- 对于线性或径向布局，可通过重排列和反转来帮助分辨叶子
	- 根据多个方面，如：数据层次和结构、布局、应用等，来决定 f。
		- 例如图6，布局对分辨不同主支很有帮助，就可以选取大的 f。
		- 例如图7，主支 ABCD 难以分辨，适合选小的 f。
	
	![](/images/blogs/vis/Tree Colors4.png)
	![](/images/blogs/vis/Tree Colors5.png)

## 3.2 色度和亮度
- 方法：
	- 加色法：深度增加，亮度增加，饱和度减少
	- 减色法：深度增加，亮度减少，饱和度增加
- 原因：
	- 更明亮的原色有过渡饱和的倾向
	- 对于暗色，高色度有助于区分
- 说明：本文使用减色法，作者提出了一系列参数参考和分析，但具体应该依据总层数和关注的层

	![](/images/blogs/vis/Tree Colors6.png)
	![](/images/blogs/vis/Tree Colors7.png)
	![](/images/blogs/vis/Tree Colors8.png)

## 3.3 参数概览
![](/images/blogs/vis/Tree Colors9.png)
	
## 3.4 色觉障碍
- Tree Color 应能被色觉障碍的人群使用
- 原因：
	- 正常：具有正常颜色视觉的人们通过三类锥视蛋白（S、M、L 锥视蛋白）在短（蓝）、中（绿）、长（红）波长处具有吸收峰，从而感知颜色。
	- 二色：
		- 原因：色盲人群只有两类或更少锥视蛋白。
		- 结果：不能识别某种颜色
	- 三色异常：
		- 原因：可能有三类，但其中两个吸收峰比正常更接近。
		- 结果：难以分辨某些颜色
- 解决方案：
	- 方案：调整 Tree Colors 方法，删掉障碍的色调范围
	- 问题：锥视蛋白对颜色的适应是近似对数的而不是线性的
	- 结果：二色和三色异常人群将失去对 HCL 颜色空间的感知特性

- 例子：绿色弱和红色盲的仿真
	- 绿色弱：三色异常，可以分辨所有色调，但饱和度和亮度不相等。
	- 红色盲：二色，色调多样性减少，饱和度和亮度也有很大变化。
![](/images/blogs/vis/Tree Colors10.png)

# 四、软件
- 树图、节点链接图：R 语言，treemap 包，布局算法
- sunburst 图：d3.js，Tree Colors

# 五、应用
- 本节讨论 Tree Colors 树可视化的真实世界数据应用

# 六、用户研究

# 七、讨论
- 工作总结
- 用颜色来编码层次结构不是新奇的，但本文有两个创新点
	1. hue gap
	2. permiutation and reversals
- 对于节点链接图，Tree Colors 的确是有用的增强
- 本文的局限性和未来方向
	1. 配色只适合线性布局或径向布局。对于二维可视化方法，如 treemap，配色仍不够好。深度的研究应该提升排列和反转方法。
	2. 减色法和加色法各自的偏好和作用的研究。
	3. 分析响应时间来揭示不同配色方案的有效性之间的差异、进行眼睛跟踪实验来了解参与者对可视树形结构的理解。
	4. 对色调值范围，非基本颜色附近是难以完美线性察觉的。
	5. 色觉障碍难以良好克服，而这一问题是重要的。
	6. 对于大型多层次数据集，其效果是未知且不乐观的。

	
# 我的反思
1. 关于偶数节点的子节点都反转，为何不改成节点的偶数子节点反转，是会造成感知顺序问题吗？
2. 反转对第一个和最后一个的影响？
	
	
	
	
	
	
	
	